{% extends 'base.html' %}
{% load i18n static %}
{% block title %}{% trans 'Checkout' %}{% endblock %}
{% block content %}
<div class="font-c-sans md:max-w-lg mx-auto">
  {% if not billing_profile %}
  <div class="md:flex justify-between text-xl text-center m-auto mt-12">
    <div>
      <h1 class="font-semibold mb-5">{% trans 'Have an account?' %}</h1>
      <a href="{% url 'login' %}?next={{ request.get_full_path|urlencode }}" class="bg-white border-4 border-yellow-400 hover:border-yellow-500 rounded-xl overflow-hidden focus:outline-none focus:ring-2 focus:ring-yellow-200 focus:ring-offset-transparent focus:ring-offset-2 py-2 px-3">{% trans 'Log In' %}</a>
    </div>

    <div class="border-t border-gray-300 sm:border-none pt-4 sm:pt-0 mt-6 sm:mt-0">
      <h1 class="font-semibold mb-5">{% trans 'First time?' %}</h1>
      <a href="{{ register_url }}?next={{ request.get_full_path|urlencode }}" class="bg-gradient-to-tr to-yellow-300 from-yellow-400 hover:to-yellow-300 hover:from-yellow-500 text-gray-800 border-2 border-yellow-300 hover:border-yellow-400 rounded-lg overflow-hidden focus:outline-none focus:ring-2 focus:ring-yellow-200 focus:ring-offset-transparent focus:ring-offset-2 py-2 px-3">{% trans 'Sign Vp' %}</a>
    </div>
  </div>
  {% else %}

  {% if not object.shipping_address and shipping_address_required %}
  <div class="text-center{% if not address_qs %} max-w-xs mx-auto{% endif %} mb-4">
    <h1 class="text-2xl border-b border-gray-300 font-semibold pb-3 {% if address_qs %}w-full{% else %}md:mx-4 xl:mx-10{% endif %}">{% trans 'Shipping Address' %}</h1>
  </div>
  {% if address_qs %}
  <div class="space-y-4 md:space-y-0 md:space-x-8 md:inline-flex">
    <div class="md:w-1/2 border-b border-gray-300 md:border-none pb-6 md:pb-0">
      <p class="font-semibold">{% trans 'Same shipping address?' %}</p>
      {% include 'addresses/prev_addresses.html' with address_qs=address_qs next_url=request.build_absolute_uri action_url=checkout_address_reuse address_type='shipping' %}
    </div>
    <div class="md:w-1/2">
      {% include 'addresses/form.html' with form=address_form next_url=request.build_absolute_uri action_url=checkout_address_create address_type='shipping' add_next_btn=shipping_address_required %}
    </div>
  </div>
  {% else %}
  <div class="mx-auto">
    {% include 'addresses/form.html' with form=address_form next_url=request.build_absolute_uri action_url=checkout_address_create address_type='shipping' %}
  </div>
  {% endif %}

  {% elif not object.billing_address %}
  <div class="text-center{% if not shipping_address_required %} max-w-xs mx-auto{% endif %} mb-4">
    <h1 class="text-2xl border-b border-gray-300 font-semibold pb-3 {% if address_qs %}w-full{% else %}md:mx-4 xl:mx-10{% endif %}">{% trans 'Billing Address' %}</h1>
  </div>
  {% if shipping_address_required %}
  <div class="space-y-4 md:space-y-0 md:space-x-8 md:inline-flex">
    <div class="md:w-1/2 border-b border-gray-300 md:border-none pb-6 md:pb-0">
      <p class="font-semibold">{% trans 'Is it the same of your shipping address?' %}</p>
      {% include 'addresses/prev_addresses.html' with address_qs=address_qs next_url=request.build_absolute_uri action_url=checkout_address_reuse address_type='billing' %}
    </div>
    <div class="md:w-1/2">
      {% include 'addresses/form.html' with form=address_form next_url=request.build_absolute_uri action_url=checkout_address_create address_type='billing' add_next_btn=shipping_address_required %}
    </div>
  </div>
  {% else %}
  <div class="max-w-xs mx-auto">
    {% include 'addresses/form.html' with form=address_form next_url=request.build_absolute_uri action_url=checkout_address_create address_type='billing' %}
  </div>
  {% endif %}

  {% else %}
  {% if has_card %}
  <div class="wxs">
    <div class="bordb text-center">
      <h1 class="h1">{% trans 'Review' %}</h1>
    </div>
    <div class="space-y-1 py-6">
      <p><span class="font-semibold">Product{% if object.cart.products.all|length > 1 %}s{% endif %}</span>:
        {% for product in object.cart.products.all %}
        <a href="{{ product.get_absolute_url }}" class="text-blue-600 hover:text-blue-700 hover:underline cr2">{{ product }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}
      </p>
      <p><span class="font-semibold">{% trans 'Billing Address' %}</span>: {{ object.billing_address.get_address }}</p>
      <p><span class="font-semibold">{% trans 'Payment Method' %}</span>: {{ billing_profile.default_card }}**
        (<a href="{{ billing_profile.get_payment_method_url }}?next={{ request.build_absolute_uri }}" class="text-blue-600 hover:text-blue-700 hover:underline cr2">{% trans 'Update' %}</a>)
      </p>
      {% if shipping_address_required %}
      <p><span class="font-semibold">{% trans 'Shipping Address' %}</span>: {{ object.shipping_address.get_address }}</p>
      <p><span class="font-semibold">{% trans 'Shipping Total' %}</span>: {% include 'base/snippets/currency.html' %}{{ object.shipping_total }}</p>
      {% endif %}
      <p><span class="font-semibold">{% trans 'Cart Total' %}</span>: {% include 'base/snippets/currency.html' %}{{ object.cart.total }}</p>
      
      <p><span class="font-semibold">{% trans 'Order Total' %}</span>: {% include 'base/snippets/currency.html' %}{{ object.total }}</p>
    </div>
    <form method="post" class="text-center text-lg"> {% csrf_token %}
      <button type="submit" class="cbtn">
        <span class="inline-flex items-center">
          <svg class="w-4 h-4 fill-current mr-2"><use xlink:href="{% static 'img/svg-defs.svg' %}#checkout"></use></svg>
          {% trans 'Complete' %}
        </span>
      </button>
    </form>
  </div>
  {% else %}
  {% include 'billing/payment-method.html' with publish_key=publish_key next_url=request.build_absolute_uri %}
  {% endif %}
  {% endif %}
  {% endif %}
</div>
{% endblock %}
{% comment %}<!-- action="" { { billing_url }} include 'accounts/register.html' %}
<p>Continue as Guest</p>{ % url "guest_register" as guest_register_url form=guest_form action_url=guest_register_url %}
<a class="inline-block rounded bg-yellow-300 hover:bg-yellow-400 border-b-4 border-yellow-400 hover:border-yellow-300 p-2 pb-1" href="{{ register_url }}">Sign Up</a>
<a class="inline-block text-center mx-auto rounded bg-yellow-400 hover:bg-yellow-300 border-b-4 border-yellow-300 hover:border-yellow-400 p-2 pb-1" href="{{ login_url }}">Enter</a>
{ % include 'accounts/snippets/form.html' with form=register_form next_url=request.build_absolute_uri action_url=register_url %}
{ % include 'accounts/snippets/form.html' with form=login_form next_url=request.build_absolute_uri %}
?next={ { cart_url }} check_done bug { % include 'accounts/snippets/form.html' with form=login_form next_url=request.build_absolute_uri % uppercase border-2 bg-yellow-400 border-yellow-400 hover:bg-yellow-500 hover:border-yellow-500 hover:text-white rounded text-sm py-1 px-2 -->
{% endcomment %}