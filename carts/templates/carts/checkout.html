{% extends 'base.html' %}
{% load i18n static %}
{% block title %}{% trans 'Checkout' %}{% endblock %}
<!--{% comment %} include 'accounts/register.html' %}
<p>Continue as Guest</p>{ % url "guest_register" as guest_register_url form=guest_form action_url=guest_register_url %}
<a class="inline-block rounded bg-yellow-300 hover:bg-yellow-400 border-b-4 border-yellow-400 hover:border-yellow-300 p-2 pb-1" href="{{ register_url }}">Sign Up</a>
<a class="inline-block text-center mx-auto rounded bg-yellow-400 hover:bg-yellow-300 border-b-4 border-yellow-300 hover:border-yellow-400 p-2 pb-1" href="{{ login_url }}">Enter</a>
{ % include 'accounts/snippets/form.html' with form=register_form next_url=request.build_absolute_uri action_url=register_url %}
{  include 'accounts/snippets/form.html' with form=login_form next_url=request.build_absolute_uri % }
{ % url 'learn:booknotes' slug=instance.slug
{# email activation bug { % include 'accounts/snippets/form.html' with form=register_form next_url=request.build_absolute_uri action_url=register_url %}
{ % include 'accounts/snippets/form.html' with form=login_form next_url=request.build_absolute_uri %}
?next={ { cart_url }} check_done bug { % include 'accounts/snippets/form.html' with form=login_form next_url=request.build_absolute_uri % uppercase border-2 bg-yellow-400 border-yellow-400 hover:bg-yellow-500 hover:border-yellow-500 hover:text-white rounded text-sm py-1 px-2{% endcomment %} -->
{% block content %}
<div class="font-c-sans max-w-xs px-6 xl:max-w-lg m-auto">
  {% if not billing_profile %}
  <div class="md:flex justify-between text-lg text-center m-auto mt-12">
    <div>
      <h1 class="font-semibold mb-5">{% trans 'Enter' %}</h1>
      <a href="{% url 'login' %}?next={{ request.get_full_path|urlencode }}" class="bg-white border-4 border-yellow-400 hover:border-yellow-500 rounded-xl overflow-hidden focus:outline-none focus:ring-2 focus:ring-yellow-200 focus:ring-offset-transparent focus:ring-offset-2 py-2 px-3">{% trans 'Log in' %}</a>
    </div>

    <div class="border-t border-gray-300 sm:border-none pt-4 sm:pt-0 mt-6 sm:mt-0">
      <h1 class="font-semibold mb-5">{% trans 'First Time?' %}</h1>
      <a href="{{ register_url }}?next={{ request.get_full_path|urlencode }}" class="inline-fle items-center bg-gradient-to-tr to-yellow-300 from-yellow-400 hover:to-yellow-300 hover:from-yellow-500 text-gray-800 border-2 border-yellow-300 hover:border-yellow-400 rounded-lg overflow-hidden focus:outline-none focus:ring-2 focus:ring-yellow-200 focus:ring-offset-transparent focus:ring-offset-2 py-2 px-3">{% trans 'Sign Vp' %}</a>
    </div>
  </div>
  {% else %}

  {% if not object.shipping_address and shipping_address_id_required %}
  <div class="border-b border-gray-300">
    <p class="text-lg font-semibold uppercase text-center pb-4">{% trans 'Shipping Address' %}</p>
  </div>
  {% if address_qs %}
  <div class="md:inline-flex">
    <div class="md:w-1/2 border-b border-gray-300 md:border-none pt-6 lg:pt-8 pb-6">
      {% include 'addresses/prev_addresses.html' with address_qs=address_qs next_url=request.build_absolute_uri action_url=checkout_address_reuse address_type='shipping' %}
    </div>
    <div class="md:w-1/2">
      {% include 'addresses/form.html' with form=address_form next_url=request.build_absolute_uri action_url=checkout_address_create address_type='shipping' add_next_btn=shipping_address_id_required %}
    </div>
  </div>
  {% else %}
  <div class="mx-auto">
    {% include 'addresses/form.html' with form=address_form next_url=request.build_absolute_uri action_url=checkout_address_create address_type='shipping' %}
  </div>
  {% endif %}

  {% elif not object.billing_address %}
  <div class="text-center {% if not shipping_address_id_required %}max-w-xs mx-auto{% endif %}">
    <h1 class="text-lg inline-flex border-b border-gray-300 font-semibold uppercase pb-4">{% trans 'Billing Address' %}</h1>
  </div>
  {% if shipping_address_id_required %}
  <div class="md:inline-flex">
    <div class="md:w-1/2 border-b border-gray-300 md:border-none pt-6 lg:pt-8 pb-6 md:pr-2">
      <p class="font-semibold pb-4">{% trans 'Is your Shipping the same of your Billing Address?' %}</p>
      {% include 'addresses/prev_addresses.html' with address_qs=address_qs next_url=request.build_absolute_uri action_url=checkout_address_reuse address_type='billing' %}
    </div>
    <div class="md:w-1/2">
      {% include 'addresses/form.html' with form=address_form next_url=request.build_absolute_uri action_url=checkout_address_create address_type='billing' add_next_btn=shipping_address_id_required %}
    </div>
  </div>
  {% else %}

  <div class="mx-auto">
  {% include 'addresses/form.html' with form=address_form next_url=request.build_absolute_uri action_url=checkout_address_create address_type='billing' %}
  </div>
  {% endif %}

{% else %}
  {% if not has_card %}
  {% include 'billing/payment-method.html' with publish_key=publish_key next_url=request.build_absolute_uri %}
  {% else %}
  <div class="border-b border-gray-300">
    <p class="text-lg font-semibold uppercase pb-3 text-center">{% trans 'Review' %}</p>
  </div>
  <div class="mx-auto mt-6">
    <p>Product{% if object.cart.products.all|length > 1 %}s{% endif %}:
      {% for product in object.cart.products.all %}
      <a href="{{ product.get_absolute_url }}" class="hover:text-blue-600 un">{{ product }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}</p>
      <!--{#{ % url 'products' slug=product.slug % products_url }}/{ { product.slug } #}-->
    <p class="my-1">{% trans 'Billing Address' %}: {{ object.billing_address.get_address }}</p>
    <p>{% trans 'Payment Method' %}: {{ billing_profile.default_card }}**
      (<a class="text-blue-700 un rounded-sm focus:outline-none focus:shadow-outline" href="{{ billing_profile.get_payment_method_url }}?next={{ request.build_absolute_uri }}">{% trans 'Is it correct?' %}</a>)
    </p>
    <p class="my-1">{% trans 'Cart Total' %}: {% include 'carts/snippets/currency.html' %}{{ object.cart.total }}</p>
    {% if shipping_address_id_required %}
    <p>{% trans 'Shipping Address' %}: {{ object.shipping_address.get_address }}</p>
    <p class="my-1">{% trans 'Shipping Total' %}: {% include 'carts/snippets/currency.html' %}{{ object.shipping_total }}</p>
    {% endif %}
    <p>{% trans 'Order Total' %}: {% include 'carts/snippets/currency.html' %}{{ object.total }}</p>
    <form class="form mt-6 text-center" method="POST" action=""> {% csrf_token %}
      <button type="submit"
        class="w-1/2 inline-flex items-center uppercase border-2 bg-yellow-400 border-yellow-400 hover:bg-yellow-600 hover:border-yellow-600 hover:text-white rounded outline-none text-sm py-1 px-2">{% trans 'Complete' %}
        <svg class="w-4 h-4 fill-current ml-1">
          <use xlink:href="{% static 'img/svg-defs.svg' %}#check"></use>
        </svg>
      </button>
    </form>
  </div>
  {% endif %}
  {% endif %}
  {% endif %}
</div>
{% endblock %}
<!--{# if user.currency == None or user.currency == '$' %}$ {{ instance.price }}{ % elif user.currency == '£' %}{{ user.currency }} {{ instance.price }}{ % elif user.currency == '€' %}{{ instance.price }} {{ user.currency }}{% endif #}-->